!function(t){var n=!(!t.history||!t.history.pushState),e={version:"0.0.1",routes:{},options:{html5:!0}},r="",i=function(t,n){var e=n.match(t.pattern);if(e){for(var r={},i=0,o=e.length;o>i;i++){var a=t.params[i-1];r[i]=e[i],a&&(r[a]=e[i])}return r}};e.match=function(t){var n=this.routes,e=!1;for(var r in n)if(n[r].pattern.pattern.test(t)){e=!0;break}return e},e.route=function(t,n){var e=this.routes[t]=new c(t);return"function"==typeof n&&e.enter(n),e},e.navigate=function(i,o){o||(o={}),"/"!==i[0]&&(i="/"+i),r!==i&&(e._dispatch(i),n?(e.options.html5||(i="#"+i),o.replace?t.history.replaceState(null,null,i):t.history.pushState(null,null,i)):(o.replace&&t.history.back(),t.location.hash=i))},e.forward=e.go=function(n){t.history.go(n||1)},e.back=function(n){t.history.go(-n||-1)},e._dispatch=function(t){if("/"!==t[0]&&(t="/"+t),r!==t){for(var n in this.routes){var e=this.routes[n],o=i(e.pattern,t),a=i(e.pattern,r);if(o){for(var c=e.stack.enter,u=[],n=0,f=c.length;f>n;n++)!function(t){u.push(function(n){c[t](o,n)})}(n);s(u)}if(a){for(var h=e.stack.exit,p=[],n=0,f=h.length;f>n;n++)!function(t){p.push(function(n){h[t](a,n)})}(n);s(p)}}r=t}};var o=/(\()?([:\*])(\w*)\)?/g,a=function(t){var n=[],e=t.replace(/(\/|\.)/g,"\\$&").replace(o,function(t,e,r,i){if(n.push(i),"*"===r)var o="(.*?)";else var o="([^/]+)";return e&&(o+="?"),o});return{params:n,pattern:new RegExp("^"+e+"$")}},s=function(t,n){if("function"!=typeof n&&(n=function(){}),!t.length)return n();var e=0,r=function(){t[e](function(i){i?(n(i),n=function(){}):(e++,e>=t.length?n():r())})};r()},c=function(t){this.path=t,this.pattern=a(t),this.stack={enter:[],exit:[]}},u=function(t){return"[object Array]"===Object.prototype.toString.call(t)};c.prototype.enter=function(t){return"function"==typeof t?this.stack.enter.push(t):u(t)&&(this.stack.enter=this.stack.enter.concat(t)),this},c.prototype.exit=function(t){return"function"==typeof t?this.stack.exit.push(t):u(t)&&(this.stack.exit=this.stack.exit.concat(t)),this};var f=function(){e._dispatch(t.location.pathname)},h=function(){e._dispatch(t.location.hash)};n?t.addEventListener?t.addEventListener("popstate",f,!1):t.onpopstate=f:t.addEventListener?t.addEventListener("hashchange",h,!1):t.onhashchange=h,"undefined"!=typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:t.navi=e}(window);